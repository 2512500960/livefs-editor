#!/usr/bin/python3

import sys

from livefs_edit.context import EditContext
from livefs_edit import actions

isopath = sys.argv[1]
destpath = sys.argv[2]

ctxt = EditContext(isopath)
ctxt.mount_iso()

try:
    actions.setup_tree(ctxt, target='tree')
    actions.replace_file(
        ctxt, sys.argv[3], 'new/iso/casper/installer.squashfs')
    actions.replace_file(
        ctxt, sys.argv[4], 'new/iso/casper/filesystem.squashfs')

    ctxt.repack_iso(destpath)
finally:
    ctxt.teardown()
